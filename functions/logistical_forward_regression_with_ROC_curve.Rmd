---
title: "logistical regressions with ROC curve"
output: md_document
---

get & prep data
```{r get & prep data}
data <- read.csv('../data/CPP_data_all.csv', header=TRUE)
smq <- read.csv('../data/SMQ.csv', header=TRUE)
smq$smq_id <- (18 - smq$smq_id) / 6
library(plyr)
data <- ddply(data, .(URSI, SM_dx), summarize,
              Turn_Count=sum(Turn_Count),
              Child_Voc_Count=sum(Child_Voc_Count),
              Child_Voc_Duration=sum(Child_Voc_Duration),
              Child_NonVoc_Duration=sum(Child_NonVoc_Duration),
              Average_SignalLevel=mean(Average_SignalLevel),
              Peak_SignalLevel=max(Peak_SignalLevel)
              )
data <- merge(data, smq, by="URSI", all=TRUE)
remove(smq)
data$SM_dx <- factor(data$SM_dx)
```

subset train/test
```{r subset train/test}
set.seed(2)
train_ind <- sample(seq_len(nrow(data)), size=19)

train <- data[train_ind, ]
test <- data[-train_ind, ]
```

logistical regression predicting SM dx
```{r logistical regression predicting SM dx, overfitting}
overfit.model <- glm(SM_dx ~ Child_Voc_Count+Turn_Count+Child_Voc_Duration+Child_NonVoc_Duration+Average_SignalLevel+Peak_SignalLevel, family=binomial(link='logit'), data=data, na.action=na.pass)
summary(overfit.model)
anova(overfit.model, test="Chisq")
```

ROC for logistical regression
```{r ROC for logistical regression, overfitting}
library('ROCR')
overfit.p <- predict(overfit.model, newdata=data, type="response")
overfit.pr <- prediction(overfit.p, data$SM_dx)
overfit.prf <- performance(overfit.pr, measure="tpr", x.measure="fpr")
plot(overfit.prf)
```

AUC for ROC
```{r AUC for ROC, overfitting}
overfit.auc <- performance(overfit.pr, measure="auc")
overfit.auc <- overfit.auc@y.values[[1]]
overfit.auc
```

logistical regression predicting SM dx
```{r logistical regression predicting SM dx}
model <- glm(SM_dx ~ Child_Voc_Count+Turn_Count+Child_Voc_Duration+Child_NonVoc_Duration+Average_SignalLevel+Peak_SignalLevel, family=binomial(link='logit'), data=train, na.action=na.pass)
summary(model)
anova(model, test="Chisq")
```

```{r ROC curve}
p <- predict(model, newdata=test, type="response")
pr <- prediction(p, test$SM_dx)
prf <- performance(pr, measure="tpr", x.measure="fpr")
plot(prf)
```

```{r AUC for ROC}
auc <- performance(pr, measure="auc")
auc <- auc@y.values[[1]]
auc
```

forward logistical regression
```{r forward logistical regression for sm dx, overfitting}
library("MASS")
fwd.overfit.model <- stepAIC(glm(SM_dx ~ 1, family=binomial(link='logit'), data=data, na.action=na.pass), direction='forward',
                     scope=~Child_Voc_Count+Turn_Count+Child_Voc_Duration+Child_NonVoc_Duration+Average_SignalLevel+Peak_SignalLevel)
fwd.overfit.model$anova
```

ROC, AUC
```{r ROC, AUC for forward logistical regression, overfitting}
fwd.overfit.p <- predict(fwd.overfit.model, newdata=data, type="response")
fwd.overfit.pr <- prediction(fwd.overfit.p, data$SM_dx)
fwd.overfit.prf <- performance(fwd.overfit.pr, measure="tpr", x.measure="fpr")
plot(fwd.overfit.prf)
fwd.overfit.auc <- performance(fwd.overfit.pr, measure="auc")
fwd.overfit.auc <- fwd.overfit.auc@y.values[[1]]
fwd.overfit.auc
```

forward logistical regression without overfitting
```{r forward logistical regression for sm dx without overfitting}
fwd.model <- stepAIC(glm(SM_dx ~ 1, family=binomial(link='logit'), data=train, na.action=na.pass), direction='forward', scope=~Child_Voc_Count+Turn_Count+Child_Voc_Duration+Child_NonVoc_Duration+Average_SignalLevel+Peak_SignalLevel)
fwd.model$anova
```

ROC, AUC
```{r ROC, AUC for forward logistic regression for sm dx without overfitting}
fwd.p <- predict(fwd.model, newdata=test, type="response")
fwd.pr <- prediction(fwd.p, test$SM_dx)
fwd.prf <- performance(fwd.pr, measure="tpr", x.measure="fpr")
plot(fwd.prf)
fwd.auc <- performance(fwd.pr, measure="auc")
fwd.auc <- fwd.auc@y.values[[1]]
fwd.auc
```

forward regression for SMQ
```{r forward regression for smq, overfitting}
fwd.overfit.smq.model <- step(lm(smq_as+smq_hf+smq_ss+smq_id ~ 1, data=data[complete.cases(data),], na.action=na.omit), direction='forward', scope=~Child_Voc_Count+Turn_Count+Child_Voc_Duration+Child_NonVoc_Duration+Average_SignalLevel+Peak_SignalLevel)
fwd.overfit.smq.model$anova
summary(fwd.overfit.smq.model)
```

partial regression plot
```{r}
library("car")
av.plots(fwd.overfit.smq.model)
```

```{r}
plot(smq_as+smq_hf+smq_ss+smq_id ~ Child_Voc_Count, data=data[complete.cases(data),])
abline(lm(smq_as+smq_hf+smq_ss+smq_id ~ Child_Voc_Count, data=data[complete.cases(data),]))
```

```{r}
plot(smq_as+smq_hf+smq_ss+smq_id ~ Child_Voc_Duration, data=data[complete.cases(data),])
abline(lm(smq_as+smq_hf+smq_ss+smq_id ~ Child_Voc_Duration, data=data[complete.cases(data),]))
```

```{r}
plot(smq_as+smq_hf+smq_ss+smq_id ~ Average_SignalLevel, data=data[complete.cases(data),])
abline(lm(smq_as+smq_hf+smq_ss+smq_id ~ Average_SignalLevel, data=data[complete.cases(data),]))
```